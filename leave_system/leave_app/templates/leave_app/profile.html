{% extends 'leave_app/base.html' %}

{% block title %}
    <title>User Profile</title>
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h1>User Profile</h1>

        {% if messages %}
            <div class="alert alert-success fade show" role="alert" id="message-alert">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        {% endif %}

        <form method="POST" action="{% url 'update_profile' profile.id %}" enctype="multipart/form-data"> 
            {% csrf_token %}  {# CSRF token for security #}

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ profile.user.username }}" readonly>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ profile.user.email }}" required>
            </div>

            <div class="form-group">
                <label for="phone_number">Phone Number</label>
                <input type="text" class="form-control" id="phone_number" name="phone_number" value="{{ profile.phone_number }}" required>
            </div>

            <div class="form-group">
                <label for="address">Address</label>
                <input type="text" class="form-control" id="address" name="address" value="{{ profile.address }}" required>
            </div>

            <div class="form-group">
                <label for="date_of_birth">Date of Birth</label>
                <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" value="{{ profile.date_of_birth|date:'Y-m-d' }}" required>
            </div>

            <div class="form-group">
                <label for="profile_picture">Profile Picture</label>
                <input type="file" class="form-control" id="profile_picture" name="profile_picture">
                {% if profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" class="img-thumbnail mt-2" style="max-width: 150px;">
                {% endif %}
            </div>

            <button type="submit" class="btn btn-success">Update Profile</button>
            <a href="{% if profile.user.is_employee %}{% url 'employee_dashboard' %}{% elif profile.user.is_manager %}{% url 'manager_dashboard' %}{% elif profile.user.is_superuser %}{% url 'admin_dashboard' %}{% endif %}" class="btn btn-secondary">Back to Home</a>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    <style>
        .fade {
            opacity: 0;
            transition: opacity 1s ease-out; /* Smooth fade-out transition */
        }

        .show {
            opacity: 1;
            transition: opacity 1s ease-in; /* Smooth fade-in transition */
        }
    </style>

    <script>
        // Auto-dismiss message alert after 3 seconds
        window.onload = function() {
            const messageAlert = document.getElementById('message-alert');
            if (messageAlert) {
                setTimeout(function() {
                    messageAlert.classList.remove('show');  // Remove the 'show' class to start fading out
                    messageAlert.classList.add('fade');      // Add fade class for opacity transition
                }, 3000); // Wait 3 seconds before starting to fade out

                setTimeout(function() {
                    messageAlert.style.display = 'none';  // Hide the alert after fading out
                }, 4000); // Wait a total of 4 seconds before setting display to none
            }
        };
    </script>
{% endblock %}
